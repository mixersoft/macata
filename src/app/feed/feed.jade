//- ion-list
ion-list.feed
  div.scope-locals.hide
    {{ vm=$parent.$parent.vm;''}}
    {{ $show=vm.settings.show;''}}
    {{ $filteredFeed=vm.$$filteredFeed;''}}
    {{ $feedHelpers=vm.feedHelpers;''}}
    {{ $postHelpers=vm.postHelpers;''}}
    {{ $postDefaults=$feedHelpers.postDefaults;''}}
  ion-item.item-divider.item-button-right.item-royal
    p
      span.light feed
    button.button.button-icon.button-light.button-clear.ion-plus(
      ng-click="$feedHelpers.showMessageComposer($event);$event.stopImmediatePropagation()"
      )
  message-composer(
      ng-show="$feedHelpers.show.messageComposer"
      header-text="Post to Feed"
      placeholder-text="What are you thinking..."
      post-button="vm.on.postCommentToFeed(value)"
      message="$postDefaults.message"
      attachment="$postDefaults.attachment"
      address="$postDefaults.address"
      location="$postDefaults.location"
      )
      
  div(ng-repeat="$post in $filteredFeed track by $post.head._id" )
    ion-item.item-notification.tile.item-complex(
       ng-if="$post.type==='Notification'"
      )
      div.card
        ion-item.item-calm.item-button-right(
          )
          button.button.close.button-clear.button-icon.ion-close-circled.button-dark(
            ng-click="$postHelpers.dismissItem($event, $post)"
            )
          div.item-text-wrap.dark(
            ng-bind-html="$post.body.message"
            )
        
      
      
      
    ion-item.item-complex.item-post(
       ng-if="$post.type!='Notification'"
      ) 
      div.scope-locals.hide
        {{vm=$parent.$parent.$parent.vm;''}}
        {{$postHead = $post.head;$postBody=$post.body;''}}
        {{$owner = vm.findOne('User', $postHead.ownerId);''}}
        {{$chatWithId = $postHead.recipientIds[0];''}}
        
      //- Invitation Actions  
      div.card.invitation-actions(
        ng-if='vm.inviteActions.requiresAction($post)'
        )
        ion-item.item-divider.item-royal
          div Invitation Actions
        ion-item.item-text-wrap
          b.padding-right {{$owner.profile.displayName}} 
          span.padding-right has invited you to join this table.
        div.item.item-complex.item-balanced.button-bar.condensed
          button.button.button-royal(
            ng-click="vm.inviteActions.decline($event, vm.event, $post)"
            )
            i.icon.ion-close-circled &nbsp; Decline
          button.button.button-royal(
            ng-click="vm.inviteActions.message($event, vm.event, $post)"
            )
            i.icon.ion-chatbox(
            ) &nbsp; Message
          button.button.button-royal(
            ng-click="vm.inviteActions.accept($event, vm.event, $post)"
            )
            i.icon.ion-checkmark-circled &nbsp; Accept 
                      
      //- Moderator Actions
      div.card.moderator-actions(
        ng-if='vm.moderatorActions.requiresAction($post)'
        )
        ion-item.item-divider.item-balanced
          div Moderator Actions
        ion-item.item-text-wrap
          b.padding-right {{$owner.profile.displayName}} 
          span.padding-right has requested {{$postBody.seats}} seats at the table.
        div.item.item-complex.item-balanced.button-bar.condensed
          button.button.button-balanced(
            ng-click="vm.moderatorActions.decline($event, vm.event, $post)"
            )
            i.icon.ion-close-circled &nbsp; Decline
          button.button.button-balanced(
            ng-click="vm.moderatorActions.message($event, vm.event, $post)"
            )
            i.icon.ion-chatbox(
            ) &nbsp; Message
          button.button.button-balanced(
            ng-click="vm.moderatorActions.accept($event, vm.event, $post)"
            )
            i.icon.ion-checkmark-circled &nbsp; Accept
             

      div.post-head.item.item-avatar-left(
        ng-class="{'private item-avatar-right':$chatWithId}"
        )
        div.scope-locals.hide
          {{ $chatWith = vm.findOne('User', $chatWithId);''}}
        div.avatar-wrap
          img.item-image.ink(
            ng-src="{{$owner.profile.face}}"
            ng-click="$event.stopImmediatePropagation()"
            ng-if="hack_delay_uiSref = $post"
            ui-sref="app.profile({id: $postHead.ownerId })"
            width="40"
          )
        div.header
          b.padding-right {{$owner.profile.displayName}}
          b.padding-left.pull-right(
            ng-if="$chatWithId"
            ) {{$chatWith.profile.displayName}}
          p.item-text-wrap 
            span.time-ago.padding-right(am-time-ago="$postHead.createdAt")
            span.padding-right(
              ng-if="$postBody.location"
              ) 
              i.icon.ion-location(
                ) &nbsp;
                {{$postBody.location.address}}
        div.avatar-wrap.right(
          ng-if="$chatWithId"
          )
          img.item-image.ink(
            ng-src="{{$chatWith.profile.face}}"
            ng-click="$event.stopImmediatePropagation()"
            ng-if="hack_delay_uiSref = $post"
            ui-sref="app.profile({id: $chatWithId })"
            width="40"
          )      
          
      div.item-body.post-body
        
        p.body {{$postBody.message}}

        div.tile.recipe.item.item-complex.content.ink(
          ng-if="$postBody.attachment._id"
        ) 
          div.scope-locals.hide
            {{$attachment = vm.findOne($postBody.attachment.type, $postBody.attachment._id);''}}
          div.hero.content(style="height:160px;")
            div.icon-bar.top-right-toolbar.condensed.light(
              ng-click="$event.stopImmediatePropagation()"
              )
              i.button.button-clear.larger.ion-heart.ink(
                ng-class="{'selected':$attachment.favorite}"
                )     
              i.button.button-clear.larger.ion-map.ink(
                xxx-ui-sref="app.map({'latlon':{{ $postBody.location.latlon }} })"
                )
              i.button.button-clear.larger.ink(
                ng-class="{'ion-edit': $attachment.isOwner, 'ion-fork': !$attachment.isOwner}"
                ng-click="action = $attachment.isOwner ? 'edit' : 'forkTile'; vm.on[action]($postHead.eventId, $attachment); "
                )         
              i.button.button-clear.ion-ios-upload.larger.ink(
                )
            div.feature.image(
              bg-image="{{$attachment['image']}}"
            )
          div.body.padding
            div.title.line-clamp-1 {{$attachment['title']}}
            p.description.line-clamp.line-clamp-2(
              ng-if="$attachment['description']"
              ) {{$attachment['description']}}
            p.site_name(
              ng-if="$attachment['site_name']"
              )  {{$attachment['site_name']}}

      div.item-body.post-actions
        div.likes
          span(ng-show="$postHead.likes.length")
            span(ng-repeat="userId in $postHead.likes")
              {{$person=vm.findOne('User', userId);''}}
              a(
                ui-sref="app.profile({id: person._id })"
                ) {{$index ? ',':''}} {{$person.profile.displayName}}
            span  &nbsp;likes this.
          a(
            ng-show="$postBody.comments.length"
            ng-class="{'padding-left': $postHead.likes.length}"
            ng-click="$postHelpers.showCommentForm($event, $post)"
            )
            {{$postBody.comments.length}} comment.

        div.button-bar.condensed.positive 
          button.button.button-icon.ion-heart.positive(
            ng-click="$postHelpers.like($event, $post)"
            ng-class="{'balanced': $postHead.likes.indexOf(vm.me) >= 0, 'disabled':$chatWith }"
            ) &nbsp; Like
          button.button.button-icon.ion-chatbox.positive(
            ng-click="$postHelpers.showCommentForm($event, $post)"
            ) &nbsp; Comment
          button.button.button-icon.ion-share.positive(
            ng-class="{'disabled':$chatWith }"
            ) &nbsp; Share

      div.item-body.post-comments.hide(
        )
        div.post-comment(
          ng-repeat="$comment in $postBody.comments | dateFilter"
          ) 
          div.scope-locals.hide
            {{$owner = vm.findOne('User', $comment.head.ownerId);''}}
          div.avatar-wrap 
            img.item-image.ink(
              ng-src="{{$owner.profile.face}}"
              ng-click="$event.stopImmediatePropagation()"
              ui-sref="app.profile({id: $owner._id })"
              width="40"
            )
          div.comment.item-text-wrap
            b.padding-right {{$owner.profile.displayName}} 
            span.padding-right {{$comment.body.comment}}
            span.time-ago.padding-right(am-time-ago="$comment.head.createdAt")
            div.likes.likes-and-comments
              div
                span(ng-show="$comment.head.likes.length")
                  span(ng-repeat="person in $comment.head.likes")
                    {{$index ? ',':''}} 
                    a(
                      ui-sref="app.profile({id: person._id })"
                      ) {{person.profile.displayName}}
                  span  &nbsp;likes this. &mdash;&nbsp;
                a(
                  ng-click="$postHelpers.like($event, $comment); $event.preventDefault()"
                  href="#"
                  ng-bind="$comment.head.likes.indexOf(vm.me)===-1 ? 'like' : 'unlike'"
                )

        div.comment-form
          div.scope-locals.hide
            {{owner=vm.me;''}}
          div.wrap
            div.avatar-wrap
              img.item-image.ink(
                ng-src="{{$owner.profile.face}}"
                ng-click="$event.stopImmediatePropagation()"
                ng-if="hack_delay_uiSref = owner"
                ui-sref="app.profile({id: $owner._id })"
                width="40"
              )
            textarea.comment(
              placeholder="Write a comment..."
              )
          div.actions.text-right
            button.button.button-small.button-clear.button-outline.button-positive(
              ng-click="$postHelpers.postComment($event, $post)"
              )
              span.padding-horizontal Post
